<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>CodeSignal Fourier Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link rel="stylesheet" href="./design-system/colors/colors.css">
  <link rel="stylesheet" href="./design-system/spacing/spacing.css">
  <link rel="stylesheet" href="./design-system/typography/typography.css">
  <link rel="stylesheet" href="./design-system/components/button/button.css">
  <link rel="stylesheet" href="./design-system/components/boxes/boxes.css">
  <link rel="stylesheet" href="./design-system/components/input/input.css">
  <link rel="stylesheet" href="./design-system/components/dropdown/dropdown.css">
  <link rel="stylesheet" href="./design-system/components/tags/tags.css">
  <link rel="stylesheet" href="./design-system/components/modal/modal.css">

  <link rel="stylesheet" href="./bespoke-template.css" />
  <link rel="stylesheet" href="./fourier-explorer.css" />
</head>
<body class="bespoke">
  <header class="header">
    <h1 class="heading-small">CodeSignal Fourier Explorer</h1>
    <div class="spacer"></div>
    <div id="status" class="status">Ready</div>
    <button id="btn-help" class="button button-text">Help</button>
  </header>

  <main class="main-layout">
    <aside class="sidebar">
      <section class="box card ui-card controls-card">
        <h2 class="heading-small">Fourier Decomposition Explorer</h2>
        <p class="controls-intro">Tune the signal and watch Fourier components update live.</p>

        <div class="control-group control-group--source">
          <h3 class="control-group-title">Source</h3>
          <p class="control-group-help">Choose what signal you are analyzing.</p>

          <label class="control-field">Source signal
            <div class="control-header">
              <span class="control-caption">Waveform type</span>
            </div>
            <div class="cs-dropdown" data-dropdown="source">
              <button id="source-trigger" class="cs-dropdown-trigger input compact-input" type="button" aria-haspopup="listbox" aria-expanded="false">
                <span id="source-trigger-text">Sine</span>
                <span class="cs-dropdown-caret" aria-hidden="true">▾</span>
              </button>
              <div id="source-menu" class="cs-dropdown-menu" role="listbox" aria-label="Source signal" hidden></div>
              <select id="source" class="input compact-input cs-native-select-hidden" aria-hidden="true" tabindex="-1">
                <option value="sine">Sine</option>
                <option value="two-sines">Two sines</option>
                <option value="square-series">Square (Fourier series)</option>
                <option value="irregular-shape">Irregular shape</option>
              </select>
            </div>
          </label>
        </div>

        <div class="control-group">
          <h3 class="control-group-title">Basic controls</h3>
          <p class="control-group-help">Core settings for quick exploration.</p>

          <label id="control-f1-field" class="control-field">Frequency f1 (Hz)
            <div class="control-header">
              <span class="control-caption">Primary frequency</span>
              <span id="freq1-value" class="tag editable-value">120</span>
            </div>
            <input id="freq1" class="input" type="range" min="10" max="1000" step="1" value="120" />
          </label>

          <label id="control-f2-field" class="control-field">Frequency f2 (Hz)
            <div class="control-header">
              <span class="control-caption">Shown for two-sines</span>
              <span id="freq2-value" class="tag editable-value">260</span>
            </div>
            <input id="freq2" class="input" type="range" min="10" max="2000" step="1" value="260" />
          </label>

          <label id="control-harmonics-field" class="control-field">Odd harmonics count
            <div class="control-header">
              <span class="control-caption">Shown for square-series</span>
              <span id="harmonics-value" class="tag editable-value">9</span>
            </div>
            <input id="harmonics" class="input" type="range" min="1" max="31" step="1" value="9" />
          </label>

          <label class="control-field">Low-pass cutoff bin
            <div class="control-header">
              <span class="control-caption">Main frequency filter</span>
              <div class="value-meta">
                <span id="low-pass-value" class="tag editable-value">80</span>
                <span id="low-pass-hz" class="helper-muted">≈ 5512 Hz</span>
              </div>
            </div>
            <input id="low-pass" class="input" type="range" min="1" max="1023" step="1" value="80" />
          </label>

          <label class="control-field">Spectrum scale
            <div class="control-header">
              <span class="control-caption">How bars are mapped to height</span>
              <span class="tag tag-muted">Visualization</span>
            </div>
            <div class="cs-dropdown" data-dropdown="spectrum-scale">
              <button id="spectrum-scale-trigger" class="cs-dropdown-trigger input compact-input" type="button" aria-haspopup="listbox" aria-expanded="false">
                <span id="spectrum-scale-trigger-text">dB (log)</span>
                <span class="cs-dropdown-caret" aria-hidden="true">▾</span>
              </button>
              <div id="spectrum-scale-menu" class="cs-dropdown-menu" role="listbox" aria-label="Spectrum scale" hidden></div>
              <select id="spectrum-scale" class="input compact-input cs-native-select-hidden" aria-hidden="true" tabindex="-1">
                <option value="linear">Linear</option>
                <option value="db" selected>dB (log)</option>
              </select>
            </div>
          </label>
        </div>

        <div id="advanced-accordion" class="control-group advanced-accordion">
          <button id="advanced-toggle" class="advanced-toggle" type="button" aria-expanded="false" aria-controls="advanced-body">
            <span class="control-group-title">Advanced settings</span>
            <span class="accordion-icon" aria-hidden="true">▾</span>
          </button>
          <div id="advanced-body" class="advanced-body">
            <p class="control-group-help compact-help">Resolution, windowing, and notch controls.</p>

            <label class="control-field">Samples (N)
              <div class="control-header">
                <span class="control-caption">DFT resolution (fs / N)</span>
                <span id="samples-value" class="tag editable-value">1024</span>
              </div>
              <input id="samples" class="input" type="range" min="256" max="2048" step="256" value="1024" />
            </label>

            <label class="control-field">Window type
              <div class="control-header">
                <span class="control-caption">Shape before DFT</span>
                <span class="tag">DFT input</span>
              </div>
              <div class="cs-dropdown" data-dropdown="window-type">
                <button id="window-type-trigger" class="cs-dropdown-trigger input compact-input" type="button" aria-haspopup="listbox" aria-expanded="false">
                  <span id="window-type-trigger-text">Rectangular</span>
                  <span class="cs-dropdown-caret" aria-hidden="true">▾</span>
                </button>
                <div id="window-type-menu" class="cs-dropdown-menu" role="listbox" aria-label="Window type" hidden></div>
                <select id="window-type" class="input compact-input cs-native-select-hidden" aria-hidden="true" tabindex="-1">
                  <option value="rectangular">Rectangular</option>
                  <option value="hann">Hann</option>
                </select>
              </div>
            </label>

            <label class="row inline-check">
              <input id="notch-enabled" type="checkbox" checked />
              <span>Enable notch filter</span>
            </label>

            <div id="notch-controls-row" class="control-row-two">
              <label class="control-field compact-field">Notch center
                <div class="control-header">
                  <div class="value-meta">
                    <span id="notch-bin-value" class="tag editable-value">60</span>
                    <span id="notch-bin-hz" class="helper-muted">≈ 2584 Hz</span>
                  </div>
                </div>
                <input id="notch-bin" class="input" type="range" min="1" max="1023" step="1" value="60" />
              </label>

              <label class="control-field compact-field">Notch width
                <div class="control-header">
                  <div class="value-meta">
                    <span id="notch-width-value" class="tag editable-value">3</span>
                    <span id="notch-width-hz" class="helper-muted">~ 258 Hz wide</span>
                  </div>
                </div>
                <input id="notch-width" class="input" type="range" min="0" max="24" step="1" value="3" />
              </label>
            </div>
          </div>
        </div>

        <div class="control-group control-group--example">
          <h3 class="control-group-title">Example usage</h3>
          <p class="control-group-help">One-click demo setups.</p>
          <button id="btn-example-phone-demo" class="button button-secondary" type="button">
            Phone Call: Noise Removal
          </button>
        </div>

        <div class="row controls-actions">
          <button id="btn-reset-filters" class="button button-secondary">Reset Filters</button>
          <button id="btn-reset-all" class="button button-secondary">Reset All</button>
        </div>
      </section>
    </aside>

    <section class="content-area viz-grid">
      <article class="panel box card ui-card panel-time">
        <div class="plot-header">
          <div class="plot-title-block">
            <h2 class="heading-small">Time Domain (Original vs Reconstructed)</h2>
            <p class="plot-subtitle">The waveform over time (sample index). Filtering changes the shape.</p>
          </div>
          <div class="plot-actions">
            <button id="btn-zoom-out-time" class="button button-text plot-reset-btn" type="button">Zoom out</button>
            <button id="btn-reset-zoom-time" class="button button-text plot-reset-btn" type="button">Reset zoom</button>
          </div>
        </div>
        <div id="formula-panel" class="formula-panel">
          <div class="formula-title">Formula</div>
          <div id="formula-body" class="formula-body"></div>
        </div>
        <div id="demo-metrics" class="demo-metrics" hidden></div>
        <div class="audio-controls">
          <button id="btn-play-original" class="button button-secondary">Play Original</button>
          <button id="btn-play-reconstructed" class="button button-secondary">Play Reconstructed</button>
          <button id="btn-play-difference" class="button button-secondary">Play Removed Noise</button>
          <span id="demo-processing" class="demo-processing" hidden></span>
        </div>
        <div class="plot-area" id="plot-area-time">
          <canvas id="signal-canvas" width="900" height="260"></canvas>
          <div id="tooltip-time" class="plot-tooltip" hidden></div>
        </div>
      </article>

      <article class="panel box card ui-card panel-spectrum">
        <div class="plot-header">
          <div class="plot-title-block">
            <h2 class="heading-small">Original Spectrum Magnitude</h2>
            <p class="plot-subtitle">How much of each frequency is present (peaks = strong tones).</p>
          </div>
          <div class="plot-actions">
            <button id="btn-zoom-out-original-spectrum" class="button button-text plot-reset-btn" type="button">Zoom out</button>
            <button id="btn-reset-zoom-original-spectrum" class="button button-text plot-reset-btn" type="button">Reset zoom</button>
          </div>
        </div>
        <div class="plot-area" id="plot-area-original-spectrum">
          <canvas id="spectrum-noisy-canvas" width="900" height="260"></canvas>
          <div id="tooltip-original-spectrum" class="plot-tooltip" hidden></div>
        </div>
      </article>

      <article class="panel box card ui-card panel-spectrum">
        <div class="plot-header">
          <div class="plot-title-block">
            <h2 class="heading-small">Filtered Spectrum Magnitude</h2>
            <p class="plot-subtitle">What remains after low-pass and notch filtering.</p>
          </div>
          <div class="plot-actions">
            <button id="btn-zoom-out-filtered-spectrum" class="button button-text plot-reset-btn" type="button">Zoom out</button>
            <button id="btn-reset-zoom-filtered-spectrum" class="button button-text plot-reset-btn" type="button">Reset zoom</button>
          </div>
        </div>
        <div class="plot-area" id="plot-area-filtered-spectrum">
          <canvas id="spectrum-filtered-canvas" width="900" height="260"></canvas>
          <div id="tooltip-filtered-spectrum" class="plot-tooltip" hidden></div>
        </div>
      </article>

      <section class="box card ui-card components-card">
        <h3 class="heading-small">Strongest Components</h3>
        <p class="components-note">Top frequency bins from the original spectrum (Hz and magnitude).</p>
        <ul id="components-list" class="components-list"></ul>
      </section>
    </section>
  </main>

  <dialog id="help-dialog" class="help-dialog">
    <article>
      <h2>How to Use Fourier Explorer</h2>

      <h3>What You’re Seeing</h3>
      <ul>
        <li><strong>Time Domain</strong>: the waveform over time (original vs reconstructed).</li>
        <li><strong>Spectrum (Magnitude)</strong>: “how much” of each frequency is present (peaks = strong frequencies).</li>
        <li><strong>Filtered Spectrum</strong>: what remains after applying filters in frequency space.</li>
      </ul>

      <h3>Core Controls</h3>
      <ul>
        <li><strong>Source</strong>: choose a signal to analyze.</li>
        <li><strong>Samples (N)</strong>: DFT resolution (larger N = finer frequency bins).</li>
        <li><strong>Window type</strong>: reduces spectral leakage (Hann is usually smoother than Rectangular).</li>
        <li><strong>Low-pass cutoff</strong>: keeps frequencies below the cutoff bin; removes higher frequencies.</li>
        <li><strong>Notch</strong>: removes a narrow band around the notch center bin (good for hum).</li>
        <li><strong>Spectrum scale</strong>: use dB to make quieter components visible.</li>
      </ul>

      <h3>Audio Buttons</h3>
      <ul>
        <li><strong>Play Original</strong>: plays the current signal.</li>
        <li><strong>Play Reconstructed</strong>: plays the signal after filtering + inverse transform.</li>
        <li><strong>Play Removed Noise</strong>: plays what was removed (original − reconstructed).</li>
      </ul>

      <h3>Plot Interactions</h3>
      <ul>
        <li><strong>Hover</strong>: see values at the nearest point/bin.</li>
        <li><strong>Click</strong>: zoom in around that point.</li>
        <li><strong>Drag</strong>: zoom into a selected range.</li>
        <li><strong>Zoom out</strong>: step back one level.</li>
        <li><strong>Reset zoom</strong>: return to full view.</li>
        <li><strong>Pan (zoomed)</strong>: hold <strong>Shift</strong> or <strong>Alt</strong> and drag; mouse wheel pans too.</li>
      </ul>

      <h3>One-Click Example</h3>
      <ul>
        <li>Use <strong>Example usage → Phone Call: Noise Removal</strong> to load the built-in demo.</li>
      </ul>

      <button id="btn-close-help" class="button button-primary">Close</button>
    </article>
  </dialog>

  <div id="cosmo-greeter" class="cosmo-greeter" hidden aria-live="polite">
    <div class="cosmo-bubble">
      <div id="cosmo-text" class="cosmo-text">Hi!</div>
    </div>
    <img id="cosmo-img" class="cosmo-img" src="/cosmo-wave.png" alt="Cosmo" loading="lazy" />
    <button id="btn-cosmo-close" class="cosmo-close" type="button" aria-label="Dismiss">×</button>
  </div>

  <script type="module" src="./app.js"></script>
</body>
</html>
